{% load static %}
<head>
    <link href="{% static 'filepond.min.css' %}" rel="stylesheet">
    <script src="{% static 'filepond.min.js' %}"></script>
    <link href="{% static 'filepond-plugin-image-preview.min.css' %}" rel="stylesheet">
    <script src="{% static 'filepond-plugin-image-preview.min.js' %}"></script>
    <script src="{% static 'filepond-plugin-file-validate-type.min.js' %}"></script>
    <script   src="https://code.jquery.com/jquery-3.5.1.min.js"   integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="   crossorigin="anonymous"></script>
</head>
<body>
    <!-- <form method="POST" autocomplete="off" enctype="multipart/form-data">
    {% csrf_token %}
    {{ image_form }} <br/>
    <input type="file" multiple><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
    <!-- <p>TEST</p> -->
    <!-- <input type="submit", id="saveBtn" value="Submit"> -->
    <!-- <button type="submit" class="btn btn-primary">Submit</button> -->
    <!-- </form> -->

    <label>Name</label>
    <input type="text" id="id_name">
    <input type="file" multiple><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
    <!-- <p>TEST</p> -->
    <input type="submit", id="saveBtn" value="Submit">

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var files = []
        const inputElement = document.querySelector('input[type="file"]')
        // FilePond.registerPlugin(FilePondPluginImagePreview);
        FilePond.registerPlugin(FilePondPluginFileValidateType);
        FilePond.setOptions({
            // allowImagePreview:true,
            acceptedFileTypes:['image/*']
        })
        const pond = FilePond.create( inputElement, {
            onaddfile: (err, fileItem) => {
                files.push(fileItem.file)
                console.log(files)
            }, 
            onremovefile: (err, fileItem) => {
                const index = files.indexOf(fileItem.file)
                if (index > -1) {
                    files.splice(index, 1)
                    console.log(files)}
            }
        });

        var formData = new FormData();
        $(document).on('click', '#saveBtn', function(e){ 
            formData.append('length', files.length)
            formData.append('name', $('#id_name').val())
            for (var i = 0; i < files.length; i++) {
                formData.append('images' + i, files[i])
            }
            formData.append('csrfmiddlewaretoken', '{{csrf_token}}')

            $.ajax({
                type: 'POST',
                url: '{% url "upload-images" %}',
                data: formData,
                cache: false,
                processData: false,
                contentType: false,
                enctype: 'multipart/form-data',
                success: function() {
                    alert("Post created")
                },
                error: function(xhr, errmsg, err) {
                    console.log(xhr.status + ":" + xhr.responseText)
                }
            })
        })
    })

    </script>
</body>